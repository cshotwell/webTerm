<html>
<head>
<script type="text/javascript">

function staticLoadScript(url)
{
   document.write('<script src="', url, '" type="text/JavaScript"><\/script>');
}
if (typeof jQuery == 'undefined'){
//staticLoadScript("http://ajax.googleapis.com/ajax/libs/jquery/1/jquery.min.js");
staticLoadScript("http://code.jquery.com/jquery-latest.min.js");




}
</script> 

<style type='text/css'>
@font-face{
font-family:ds_term;src:url('DS_TERM.TTF') format("truetype")
}


body{background-color:black;}

*{
padding:0px;
margin:0px;
font-family:ds_term;
}
.row{
width:100%;
height:50px;
font-size:45px;
}
#screen{

    overflow-y:hidden;

}
.charSpace{
    display:inline-block;
    
    font-size:45px;
    color:#66ff00;
    opacity:0;
    <!--float:left;-->
    text-align:center;
}

.command{
    white-space:pre-wrap;
    color:#66ff00;
    font-size:45px;
    display:inline-block;
    

}

@-webkit-keyframes blink{

    from{
        opactiy:0;
    }
    to{
        opacity:1;
    }

}


.cursor{

display:inline-block;
opacity:0;
width:25px;
height:35px;
backGround-color:#66ff00;


}

.solid{
    opacity:1;
}

.blinking{

-webkit-animation-name:blink;
-webkit-animation-duration: 500ms;
-webkit-animation-direction:alternate;
-webkit-animation-iteration-count:infinite;

}


.animateIn{
-webkit-transition-property :opacity;
-webkit-transition-timing-function:linear;
-webkit-transition-duration:100ms;
/*width:25px;*/
opacity:1;

}
.fadeOut{


}

</style>
<script type="text/javascript">
$.ajax({cache:false});


var commands = new Array();

var timerStarted = false;
var userName = "guest";
var host = window.location.hostname;
var promptText = userName+"@"+host+":~$";

//command object constructor.
function shellCommand(n, h, m){
    this.name = n;
    this.help = h;
    this.exe = function(input){stopCountDown() ; m(input) ; inputOpen = true ; startCountDown(30)}
    //this.exe = m; 
    //console.log(this.name);
    commands.push(this);
}

/*shell commands*/



var help = new shellCommand("help", "print a help message", function(){

    for (var c in commands){
        echo.exe(commands[c].name+" - "+commands[c].help);
    
    }

});


var clear = new shellCommand("clear", "clear the screen", function(){

    console.log("running clear");
    //add some animation to the foo function and call it here…
    //maybe if an arg is given?
    $('#display').html("");

});


var echo = new shellCommand("echo", "print output to screen", function(input){

        //this really need to be fixed!!!!

        console.log(input);
        if(input.indexOf(',') > -1){
            input.join().replace(/,/g, "")
        }

        $('#display').append("<p class='command'>"+input+"</p><br>");


});




var reset = new shellCommand("reset", "reset the terminal (reloads page)", function(){
    location.reload();

});




var reddit = new shellCommand("reddit", "The Front Page of the Intenet", function(count){
    
    echo.exe("Reddit - The Front Page of the Intenet");
    
    redditText= "";
    
    $.getJSON("http://www.reddit.com/.json?limit="+count+"&jsonp=?", function(data) { 
        //console.log(data);
        redditdata = data;
        reddits = data.data.children;
        for (r in reddits){
            post = reddits[r].data;
            console.log(post);
            selfText = ""
            if(post.selftext != ""){

                selfText = post.selftext.replace(/\n/g, " \\\\ ")+" \\\\ \\\\ ";
                //console.log(selfText);
            }
            redditText = redditText + post.title+" \\\\ \\\\ "+selfText+" submited by "+post.author+" \\\\ to "+post.subreddit+" \\\\ "+ convertDate(post.created_utc) +" \\\\ \\\\ ";
        
        }
        timedPrint(redditText, 75);
    });
        
    
    
});




function timedPrint(input, interval){
    stopPrinting  = function(){
            //document.body.removeEventListener("keypress");
            //console.log("stopping print");
            
            window.onkeypress = null;
            
            clearInterval(timer);
            $('#prompt').show();
            $('#input').show();
            $('p.cursor').remove().appendTo('#screen');
            screen.scrollTop = screen.scrollHeight;
            //clear.exe();
            reddit.exe();
            //startCountDown(10);
    
    
    }

    $('#prompt').hide();
    $('#input').hide();
    $('p.cursor').remove().appendTo('#display');

    charWidth = $('.cursor').width();
    rowWidth = $('#screen').width();
    
    //the number of character spaces in a row is…
    charSpace = parseInt(rowWidth/charWidth);
    charCount = 0;
    

    i=0;
    w=0;
    c=0;
    printWords = input.replace(/ /g, "| |").replace(/\|\|/g, "|").split('|');    
    
    timer = setInterval(function(){
        window.onkeypress = function(){
            console.log(this);
            console.log("key pressed");
            stopPrinting();
        }
        
        if(printWords[w] == "\\\\"){
            w++;
            c=0;
            charCount=0;
            i+=2;
            //console.log("read forced line break");
            $('<br>').insertBefore('.cursor');
            //clearInterval(timer);
        }


         $('<p class="charSpace animateIn">'+htmlSpecials(printWords[w][c])+'</p>').insertBefore('.cursor');
    
        
        charCount++;
        
        if(printWords[w].length-1 == c){
        
            c=0;
            w++
            if(charCount+printWords[w].length >= charSpace){
                $('<br>').insertBefore('.cursor');
                charCount=0;
            }
            
            
        }else{
        
            c++        
        }
        
        
        screen.scrollTop = screen.scrollHeight;
        
        i++
        
        if(i==input.length){
            stopPrinting();
        }
        
    },interval);

    $('#display').append('<br>');

}


function convertDate(utc){

    var d = new Date(0);
    d.setUTCSeconds(utc);
    return d;

}



function htmlSpecials(input){

//.replace(/&/g, "&amp;").replace(/>/g, "&gt;").replace(/</g, "&lt;").replace(/"/g, "&quot;")
return input.replace(/ /g, "&nbsp");

}

function run(input){
    commandNotFound = true;
    //console.log("input:"+input);
    
    inputOpen = false;
    //words = input.replace(/ /g, "| |").replace(/\|\|/g, "|").split('|');
    words = input.split(' ');
    
    
    command = words.shift();
    //words.shift();//remove leading space
    
    console.log(words);
    
    for( var c in commands ){
        //console.log(c+":"+commands[c].name);
        if(commands[c].name == command){
            commandNotFound = false;
            //console.log("running "+command);
            commands[c].exe(words);
            break;
        }
    
    }
    if(commandNotFound){
        echo.exe(command+": command not found. type help for a list of commands.");
        inputOpen = true;
        return; 
    }

    //I guess this has to be in the .exe function...
    //inputOpen = true;
    
    return

}



function makeAllCharSpaces(){

    $('.command').each(function(e){
        //console.log($(this).html());
        outputHtml = '';
        
        for(var c in $(this).html()){
            console.log($(this).html()[c]);
            outputHtml = outputHtml + '<div class="charSpace animateIn">'+$(this).text()[c]+'</div>';
            
        }
        $(this).html(outputHtml);
        
    });
    

}


/***used to start the on idle timer***/

function startCountDown(countDown){
    
    
    if(typeof(countDownTimer) == "undefined"){
        console.log("starting countDown");
    
        countDownTimer = setTimeout(function(){
            console.log("timer reached");
            reddit.exe(10)
        }, 1000*countDown);
    }
}


function stopCountDown(){
    if(typeof(countDownTimer)!="undefined"){
        console.log("clearing timer");
        clearTimeout(countDownTimer);
    }
}




$(document).ready(function(){

    $('body').html('<div id="screen" style="height:99%"><div id="display"></div><p id="prompt" class="command">'+userName+'@'+host+':~$</p><p id="input" class="command"></p><p class="cursor blinking"></p></div>');

});


$(function(){
    inputOpen = true;
    screen = document.getElementById('screen');

    

    startCountDown(30);
    
    
    $(document).keypress(function(e){
        //console.log('keypress');
       
        
        if(inputOpen){

            stopCountDown();
            startCountDown(30);
            console.log("resetting timer");
        
            e = e || window.e;
            var code = e.which || e.keyCode;
            var char = String.fromCharCode(code);

            //console.log(code+":"+char);
        
            switch(code){
                //up down arrows…
               
               //return
                case 13:
                    
                    //$('#display').append("<p class='command'>guest@box:~$"+$('#input').text()+"</p><br>");
                    $('#display').append('<p class="command">'+promptText+$('#input').text()+'</p><br>');
                    
                    if($('#input').text() != ""){
                        run($('#input').text());
                    }
                    $('#input').text("");
                    screen.scrollTop = screen.scrollHeight;
 
                break;
                
                
                //backspace
                case 8:
                    $('#input').text( $('#input').text().slice(0,-1) );
                    
                    break;
                
                
                //tab

                default: 
                    $('#input').append(char);
                    break;
            }
 
        }
        
        
        
    });
    
    
    
    


});

</script>
</head>

<body>

<!--<div id="screen" style="height:99%">
    <div id="display"></div>
    <p id="prompt" class="command">guest@box:~$</p><p id="input" class="command"></p><p class="cursor blinking"></p>
</div>-->

</body>



</html>